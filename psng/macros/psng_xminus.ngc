o<psng_xminus> sub
o<psng_hook> call [6]

o100 if [#<_hal[probe.ps_searchvel]> LE 0]
o100 return [-1] ; indicate searchvel <= 0
o100 endif

o200 if [#<_hal[probe.ps_probevel]> LE 0]
o200 return [-2] ; indicate probevel <= 0
o200 endif

o300 if [#5400 EQ 0]
     (MSG,PROBE WITH TOOL 0 NOT ALLOWED)
     M2
o300 endif

;ALKABAL ADD QUESTION : no need to cancel tool offset or cutercomp here if probe is used from tool table with diameter in tooltable ?
; cancel tool offset + cutter compensation
;G92.1
;G49 G40      ; for create tool table with diameter compensation this is needed to cancel cutercomp here
;ALKABAL ADD QUESTION : no need to cancel tool offset or cutercomp here ?

#<x>=#<_x> (save start X position) 
G91
G38.2 X-#<_hal[probe.ps_probe_max]>       F#<_hal[probe.ps_searchvel]>
G38.4 X#<_hal[probe.ps_probe_latch]>      F#<_hal[probe.ps_searchvel]>     ;DO NOT WORK FINE WITHOUT SPRING MOUNTED PROBE AND SETTER
G1    X0.5                                F#<_ini[TOOLSENSOR]RAPID_SPEED>
G38.2 X-[#<_hal[probe.ps_probe_latch]>*2] F#<_hal[probe.ps_probevel]>
(print, probe X=#5061 )
G90
(back to start point)
G1 X#<x> F#<_ini[TOOLSENSOR]RAPID_SPEED> 
	
o<psng_hook_end> call 
o<psng_xminus> endsub
M2
